<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewTimeAuto Showroom</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }
        .filters {
            margin: 20px 0;
            background-color: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .filter-label {
            font-weight: bold;
            color: #333;
        }
        .car-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .car-card:hover {
            transform: translateY(-5px);
        }
        .car-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .car-info {
            margin-top: 10px;
        }
        .car-info p {
            margin: 5px 0;
        }
        .question-btn {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        .question-btn:hover {
            background-color: #45a049;
        }
        .reset-btn {
            background-color: #ff4b5c;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            display: inline-block;
            width: 100%;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .reset-btn:hover {
            background-color: #f44336;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Filters Section -->
    <div class="filters mx-auto w-full max-w-4xl p-5">
        <h2 class="text-2xl font-semibold mb-4 text-center">Фильтры</h2>

        <div class="grid grid-cols-2 sm:grid-cols-4 gap-6">
            <div>
                <label for="brand" class="filter-label">Марка:</label>
                <select id="brand" class="w-full p-2 border rounded bg-gray-100">
                    <option value="">Все</option>
                </select>
            </div>
            <div>
                <label for="year" class="filter-label">Год:</label>
                <select id="year" class="w-full p-2 border rounded bg-gray-100">
                    <option value="">Все</option>
                </select>
            </div>
            <div>
                <label for="engine" class="filter-label">Двигатель:</label>
                <select id="engine" class="w-full p-2 border rounded bg-gray-100">
                    <option value="">Все</option>
                </select>
            </div>
            <div>
                <label for="price" class="filter-label">Цена:</label>
                <select id="price" class="w-full p-2 border rounded bg-gray-100">
                    <option value="">Все</option>
                </select>
            </div>
        </div>
        
        <button id="reset-filters" class="reset-btn mt-4">Сбросить фильтры</button>
    </div>

    <!-- Car Listings -->
    <div id="car-list" class="container mx-auto px-4">
        <div class="text-center text-xl font-semibold my-5">
            <p>Загрузка данных...</p>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = "1e6MBPZ3vmYdgJRHLwQIw2Ehf7TFSdWycgJ9mYnM0Ahk";
        const API_KEY = "AIzaSyB7BDWOi1pICTSaN1SdUsdTKlgW1g-v_Vc";
        
        const carListContainer = document.getElementById("car-list");
        const brandFilter = document.getElementById("brand");
        const yearFilter = document.getElementById("year");
        const engineFilter = document.getElementById("engine");
        const priceFilter = document.getElementById("price");
        const resetFiltersButton = document.getElementById("reset-filters");

        async function fetchCarData() {
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Наличие?key=${API_KEY}`);
                const data = await response.json();
                return data.values.slice(1); // Skip header row
            } catch (error) {
                console.error("Error fetching car data", error);
                return [];
            }
        }

        async function renderCarList() {
            const cars = await fetchCarData();
            const brands = new Set();
            const years = new Set();
            const engines = new Set();
            const prices = new Set();

            const filteredCars = cars.filter(car => {
                const brand = car[1];
                const year = car[3];
                const engine = car[5];
                const price = car[8];
                
                if (brand && !brands.has(brand)) brands.add(brand);
                if (year && !years.has(year)) years.add(year);
                if (engine && !engines.has(engine)) engines.add(engine);
                if (price && !prices.has(price)) prices.add(price);

                return (
                    (brandFilter.value === "" || brand === brandFilter.value) &&
                    (yearFilter.value === "" || year === yearFilter.value) &&
                    (engineFilter.value === "" || engine === engineFilter.value) &&
                    (priceFilter.value === "" || price === priceFilter.value)
                );
            });

            // Render the filter options dynamically
            populateSelect(brandFilter, Array.from(brands));
            populateSelect(yearFilter, Array.from(years));
            populateSelect(engineFilter, Array.from(engines));
            populateSelect(priceFilter, Array.from(prices));

            // Render car cards
            carListContainer.innerHTML = '';
            filteredCars.forEach(car => {
                const carCard = document.createElement('div');
                carCard.classList.add('car-card');
                carCard.innerHTML = `
                    <img src="${car[0]}" alt="${car[1]} ${car[2]}" class="car-image mb-4">
                    <div class="car-info">
                        <h3 class="text-lg font-semibold">${car[1]} ${car[2]}</h3>
                        <p><strong>Год:</strong> ${car[3]}</p>
                        <p><strong>Объем:</strong> ${car[4]}</p>
                        <p><strong>Двигатель:</strong> ${car[5]}</p>
                        <p><strong>Привод:</strong> ${car[6]}</p>
                        <p><strong>Трансмиссия:</strong> ${car[7]}</p>
                        <p><strong>Цена:</strong> ${car[8]} руб.</p>
                        <p><strong>Описание:</strong> ${car[9]}</p>
                        <a href="https://t.me/newtimeauto_sales" class="question-btn">Задать вопрос в Telegram</a>
                    </div>
                `;
                carListContainer.appendChild(carCard);
            });
        }

        function populateSelect(selectElement, options) {
            selectElement.innerHTML = '<option value="">Все</option>';
            options.forEach(option => {
                const optElement = document.createElement('option');
                optElement.value = option;
                optElement.textContent = option;
                selectElement.appendChild(optElement);
            });
        }

        function resetFilters() {
            brandFilter.value = "";
            yearFilter.value = "";
            engineFilter.value = "";
            priceFilter.value = "";
            renderCarList();
        }

        brandFilter.addEventListener("change", renderCarList);
        yearFilter.addEventListener("change", renderCarList);
        engineFilter.addEventListener("change", renderCarList);
        priceFilter.addEventListener("change", renderCarList);
        resetFiltersButton.addEventListener("click", resetFilters);

        // Initialize the page with data
        renderCarList();
    </script>

</body>
</html>
